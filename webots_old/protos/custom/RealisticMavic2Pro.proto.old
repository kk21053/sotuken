#VRML_SIM R2025a utf8
# license: Copyright Cyberbotics Ltd. Licensed for use only with Webots.
# Realistic DJI Mavic 2 Pro with accurate physical parameters
# Based on official DJI specifications

EXTERNPROTO "../vendor/appearances/protos/GlossyPaint.proto"
EXTERNPROTO "../vendor/appearances/protos/MattePaint.proto"

PROTO RealisticMavic2Pro [
  field SFVec3f    translation         0 0 0.065
  field SFRotation rotation            0 0 1 0
  field SFString   name                "Mavic 2 PRO"
  field SFString   controller          "mavic2pro"
  field MFString   controllerArgs      []
  field SFString   window              "<generic>"
  field SFString   customData          ""
  field SFBool     supervisor          FALSE
  field SFBool     synchronization     TRUE
  # Realistic battery: [current_charge_Wh, max_capacity_Wh]
  # Max: 59.29Wh (3850mAh @ 15.4V), starts at full charge
  field MFFloat    battery             [59.29, 59.29]
  field MFNode     bodySlot            []
  field MFNode     cameraSlot          [ Camera { width 400 height 240 } ]
]
{
Robot {
  translation IS translation
  rotation IS rotation
  children [
    DEF BODY_SLOT Group {
      children IS bodySlot
    }
    Shape {
      appearance DEF GREY_PLASTIC PBRAppearance {
        baseColor 0.5 0.5 0.5
        metalness 0
        roughness 0.8
      }
      geometry Mesh {
        url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/body.obj"
      }
    }
    Shape {
      appearance DEF METAL_APPEARANCE PBRAppearance {
        roughness 0.5
      }
      geometry Mesh {
        url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/body_metal_parts.obj"
      }
    }
    Shape {
      appearance DEF GLASS PBRAppearance {
        baseColor 0.523146 0.8 0.627785
        transparency 0.9
        roughness 0.5
        metalness 0
      }
      geometry Mesh {
        url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/body_lenses.obj"
      }
    }
    DEF COMPASS Compass {
    }
    DEF GPS GPS {
    }
    DEF GYRO Gyro {
    }
    DEF INERTIAL_UNIT InertialUnit {
    }
    # Rear Left Propeller
    DEF REAR_LEFT_HP_HELIX Propeller {
      shaftAxis 0 0 1
      centerOfThrust -0.177179 0.127453 -0.0320282
      # Adjusted thrust constants for realistic 907g takeoff weight
      # Each motor needs to generate ~2.27N (0.907kg * 9.81 / 4)
      thrustConstants -0.000312 0
      torqueConstants 0.0000062 0
      fastHelixThreshold 50
      device RotationalMotor {
        name "rear left propeller"
        maxVelocity 576
        maxTorque 30.0
      }
      fastHelix Solid {
        translation -0.177179 0.127453 -0.0320282
        children [
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_plates.obj"
            }
          }
          Pose {
            translation 0 0 0.02
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.5 0.5 0.5
                  baseColorMap ImageTexture {
                    url "../vendor/default/protos/textures/fast_helix.png"
                  }
                  metalness 0
                  roughness 0
                }
                geometry Cylinder {
                  radius 0.12
                  height 0.001
                  side FALSE
                }
              }
            ]
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227  # 907g / 4 motors / 10 (distributed weight)
        }
      }
      slowHelix Solid {
        translation -0.177179 0.127453 -0.0320282
        children [
          Shape {
            appearance USE GREY_PLASTIC
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a.obj"
            }
          }
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_plates.obj"
            }
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
    }
    # Rear Right Propeller
    DEF REAR_RIGHT_HP_HELIX Propeller {
      shaftAxis 0 0 1
      centerOfThrust -0.177179 -0.127453 -0.0320282
      thrustConstants -0.000312 0
      torqueConstants 0.0000062 0
      fastHelixThreshold 50
      device RotationalMotor {
        name "rear right propeller"
        maxVelocity 576
        maxTorque 30.0
      }
      fastHelix Solid {
        translation -0.177179 -0.127453 -0.0320282
        children [
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_plates.obj"
            }
          }
          Pose {
            translation 0 0 0.02
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.5 0.5 0.5
                  baseColorMap ImageTexture {
                    url "../vendor/default/protos/textures/fast_helix.png"
                  }
                  metalness 0
                  roughness 0
                }
                geometry Cylinder {
                  radius 0.12
                  height 0.001
                  side FALSE
                }
              }
            ]
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
      slowHelix Solid {
        translation -0.177179 -0.127453 -0.0320282
        children [
          Shape {
            appearance USE GREY_PLASTIC
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b.obj"
            }
          }
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_plates.obj"
            }
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
    }
    # Front Left Propeller
    DEF FRONT_LEFT_HP_HELIX Propeller {
      shaftAxis 0 0 1
      centerOfThrust 0.177179 0.127453 -0.0320282
      thrustConstants -0.000312 0
      torqueConstants 0.0000062 0
      fastHelixThreshold 50
      device RotationalMotor {
        name "front left propeller"
        maxVelocity 576
        maxTorque 30.0
      }
      fastHelix Solid {
        translation 0.177179 0.127453 -0.0320282
        children [
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_plates.obj"
            }
          }
          Pose {
            translation 0 0 0.02
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.5 0.5 0.5
                  baseColorMap ImageTexture {
                    url "../vendor/default/protos/textures/fast_helix.png"
                  }
                  metalness 0
                  roughness 0
                }
                geometry Cylinder {
                  radius 0.12
                  height 0.001
                  side FALSE
                }
              }
            ]
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
      slowHelix Solid {
        translation 0.177179 0.127453 -0.0320282
        children [
          Shape {
            appearance USE GREY_PLASTIC
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b.obj"
            }
          }
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_b_plates.obj"
            }
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
    }
    # Front Right Propeller
    DEF FRONT_RIGHT_HP_HELIX Propeller {
      shaftAxis 0 0 1
      centerOfThrust 0.177179 -0.127453 -0.0320282
      thrustConstants -0.000312 0
      torqueConstants 0.0000062 0
      fastHelixThreshold 50
      device RotationalMotor {
        name "front right propeller"
        maxVelocity 576
        maxTorque 30.0
      }
      fastHelix Solid {
        translation 0.177179 -0.127453 -0.0320282
        children [
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_plates.obj"
            }
          }
          Pose {
            translation 0 0 0.02
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 0.5 0.5 0.5
                  baseColorMap ImageTexture {
                    url "../vendor/default/protos/textures/fast_helix.png"
                  }
                  metalness 0
                  roughness 0
                }
                geometry Cylinder {
                  radius 0.12
                  height 0.001
                  side FALSE
                }
              }
            ]
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
      slowHelix Solid {
        translation 0.177179 -0.127453 -0.0320282
        children [
          Shape {
            appearance USE GREY_PLASTIC
            geometry Mesh {
              url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a.obj"
            }
          }
          Shape {
            appearance USE METAL_APPEARANCE
            geometry Mesh {
              url="../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_joint.obj"
            }
          }
          Shape {
            appearance GlossyPaint {
              baseColor 0.1 0.1 0.1
            }
            geometry Mesh {
              url="../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/helix_a_plates.obj"
            }
          }
        ]
        boundingObject Group {
          children [
            Pose {
              translation 0 0 0.015
              children [
                Cylinder {
                  height 0.025
                  radius 0.12
                }
              ]
            }
          ]
        }
        physics Physics {
          density -1
          mass 0.0227
        }
      }
    }
    # Camera gimbal
    DEF CAMERA_YAW Solid {
      translation 0.055 0 -0.05
      children [
        DEF CAMERA_YAW_HINGE HingeJoint {
          jointParameters HingeJointParameters {
            axis 0 0 1
            anchor 0.055 0 -0.05
          }
          device [
            RotationalMotor {
              name "camera yaw"
              minPosition -1.5708
              maxPosition 1.5708
            }
          ]
          endPoint DEF CAMERA_YAW_LINK Solid {
            children [
              DEF CAMERA_PITCH Solid {
                children [
                  DEF CAMERA_PITCH_HINGE HingeJoint {
                    jointParameters HingeJointParameters {
                      axis 0 1 0
                    }
                    device [
                      RotationalMotor {
                        name "camera pitch"
                        minPosition -1.5708
                        maxPosition 0.523599
                      }
                    ]
                    endPoint DEF CAMERA_PITCH_LINK Solid {
                      children [
                        DEF CAMERA_ROLL Solid {
                          children [
                            DEF CAMERA_ROLL_HINGE HingeJoint {
                              jointParameters HingeJointParameters {
                                axis 1 0 0
                              }
                              device [
                                RotationalMotor {
                                  name "camera roll"
                                  minPosition -0.610865
                                  maxPosition 0.610865
                                }
                              ]
                              endPoint DEF CAMERA_ROLL_LINK Solid {
                                children [
                                  DEF CAMERA_SLOT Group {
                                    children IS cameraSlot
                                  }
                                  Shape {
                                    appearance USE GREY_PLASTIC
                                    geometry Mesh {
                                      url "../vendor/projects/robots/dji/mavic/protos/Mavic2Pro/meshes/camera.obj"
                                    }
                                  }
                                ]
                                boundingObject Group {
                                  children [
                                    Pose {
                                      translation 0 0 -0.011
                                      children [
                                        Cylinder {
                                          height 0.04
                                          radius 0.015
                                        }
                                      ]
                                    }
                                  ]
                                }
                                physics Physics {
                                  density -1
                                  mass 0.14  # Hasselblad camera + gimbal ~140g
                                }
                              }
                            }
                          ]
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          }
        }
      ]
    }
  ]
  name IS name
  model "DJI Mavic 2 PRO"
  description "Realistic DJI Mavic 2 Pro with accurate specifications"
  boundingObject Group {
    children [
      Pose {
        translation 0.03 0 -0.04
        children [
          Box {
            size 0.22 0.09 0.055
          }
        ]
      }
      Pose {
        translation -0.145 0.106 -0.032
        rotation 0 0 1 0.68
        children [
          Box {
            size 0.01 0.12 0.018
          }
        ]
      }
      Pose {
        translation -0.145 -0.106 -0.032
        rotation 0 0 1 -0.68
        children [
          Box {
            size 0.01 0.12 0.018
          }
        ]
      }
      Pose {
        translation 0.138 0.08 -0.032
        rotation 0 0 1 2.46
        children [
          Box {
            size 0.01 0.12 0.018
          }
        ]
      }
      Pose {
        translation 0.138 -0.08 -0.032
        rotation 0 0 1 -0.68
        children [
          Box {
            size 0.01 0.12 0.018
          }
        ]
      }
      Pose {
        translation 0.06 0.15 -0.039
        rotation 1 0 0 -0.29
        children [
          Box {
            size 0.01 0.014 0.06
          }
        ]
      }
      Pose {
        translation 0.06 -0.15 -0.039
        rotation 1 0 0 0.29
        children [
          Box {
            size 0.01 0.014 0.06
          }
        ]
      }
    ]
  }
  physics Physics {
    density -1
    mass 0.907  # Official DJI spec: 907g
    centerOfMass [
      -0.088 0 -0.04
    ]
    # Max payload: 393g (1300g max takeoff - 907g body)
  }
  controller IS controller
  controllerArgs IS controllerArgs
  window IS window
  customData IS customData
  supervisor IS supervisor
  synchronization IS synchronization
  battery IS battery
}
}
