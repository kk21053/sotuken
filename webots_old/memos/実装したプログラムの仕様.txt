卒業研究として、4足歩行ロボットの故障原因をドローンとの協調診断を用いて特定する研究をシミュレーションを用いて行う。

本仕様書は、実際に実装されたプログラムの完全な仕様を記述する。

================================================================================
1. 実施環境
================================================================================
・Webots R2023b（シミュレーター）
・Spot（4足歩行ロボット：FL、FR、RL、RRの4脚）
・DJI Mavic 2 PRO（ドローン：円形軌道飛行で監視）
・RoboPose（ドローンによる姿勢推定システム）

================================================================================
2. 環境設定システム（environment_manager）
================================================================================
Spotの各脚（FL、FR、RL、RR）に対して個別の環境を設定できる。

2.1 設定可能な環境
--------------------------------------------------------------------------------
各脚に設置できる環境は以下のいずれか一つ：
・NONE（正常）
・BURIED（埋まる）：砂パッチ（SAND_PATCH）により脚が埋まる
・TRAPPED（挟まる）：足罠（FOOT_TRAP）により足先が固定される
・TANGLED（絡まる）：ツタ（FOOT_VINE）により脚が絡まる
・MALFUNCTION（故障）：センサー故障（物理的には設定不可、診断でのみ検出）
・FALLEN（転倒）：ロボットが転倒している状態（診断中に発生）

一つの脚が複数の環境を同時に設定することはない。

2.2 環境の配置方法
--------------------------------------------------------------------------------
各脚の基準位置（FOOT_OFFSETS）：
・front_left (FL):  (0.48, 0.17)
・front_right (FR): (0.36, -0.18)
・rear_left (RL):   (-0.30, 0.18)
・rear_right (RR):  (-0.30, -0.18)

環境オブジェクトは上記の基準位置を基準に配置される。

2.3 設定ファイル（scenario.ini）
--------------------------------------------------------------------------------
config/scenario.ini により環境を設定する。
主要パラメータ：
・scenario: シナリオ名（sand_burial、foot_trap、foot_vine、none）
・buriedFoot: 埋まる脚の指定（front_left、front_right等）
・trappedFoot: 挟まる脚の指定
・tangledFoot: 絡まる脚の指定
・sand.radius: 砂パッチの半径（m）
・sand.height: 砂パッチの高さ（m）
・trap.offsetX, offsetY, offsetZ: 罠の位置オフセット
・friction: 摩擦係数
・bounce: 反発係数

2.4 物理特性の調整
--------------------------------------------------------------------------------
・SAND（砂）: 摩擦係数 1.8、反発係数 0.0
・TRAP（罠）: 摩擦係数 2.5、反発係数 0.0
・VINE（ツタ）: 摩擦係数 2.0、反発係数 0.0

これらの値はContactPropertiesにより動的に適用される。

================================================================================
3. Spotの自己診断システム（spot_self_diagnosis）
================================================================================

3.1 診断パターン（6試行双方向診断）
--------------------------------------------------------------------------------
各脚に対して6回ずつ内部診断を行う。各試行は異なる関節を異なる方向に動かす：

・Trial 1: motor[2]（膝関節）+方向
・Trial 2: motor[2]（膝関節）-方向
・Trial 3: motor[1]（股関節）+方向
・Trial 4: motor[1]（股関節）-方向
・Trial 5: motor[0]（肩関節）+方向
・Trial 6: motor[0]（肩関節）-方向

各試行の設定：
・TRIAL_DURATION_S: 0.4秒（試行時間）
・TRIAL_ANGLE_DEG: 4.0度（目標角度、ただし安全範囲を考慮して最大5度に制限）
・安全マージン: 関節の可動範囲から±5度の安全余裕を確保
・速度: モーター最大速度の20%（安定性重視）

3.2 自己診断スコアの計算
--------------------------------------------------------------------------------
診断基準の重み付け：
・追従性スコア（track）: 0.4
・速度スコア（vel）: 0.25
・トルクスコア（tau）: 0.25
・安全性スコア（safe）: 0.1

総合スコア = track*0.4 + vel*0.25 + tau*0.25 + safe*0.1

3.2.1 追従性スコア（Tracking Score）
目標角度と実測角度の差に基づいて計算：
・E_MAX_DEG = 3.0度（許容誤差の基準）
・score_track = clamp(1.0 - (average_error / E_MAX_DEG))
・average_error: 試行中の全フレームでの角度誤差の平均

3.2.2 速度スコア（Velocity Score）
関節の角速度に基づいて計算：
・OMEGA_REF_DEG_PER_SEC = 27.0 度/秒（基準角速度）
・score_vel = clamp(average_omega / OMEGA_REF_DEG_PER_SEC)
・average_omega: 試行中の平均角速度

3.2.3 トルクスコア（Torque Score）
モーターのトルク負荷に基づいて計算：
・TAU_LIMIT_RATIO = 0.8（トルク限界の80%を基準）
・tau_limit: モーターの最大トルク × TAU_LIMIT_RATIO
・score_tau = clamp(1.0 - (average_tau / tau_limit))
・average_tau: 試行中の平均トルク
・トルクフィードバックが利用できない場合は加速度から推定

3.2.4 安全性スコア（Safety Score）
モーターの状態に基づいて決定：
・SAFE_SCORE_NORMAL = 1.0（正常）
・SAFE_SCORE_WARN = 0.5（警告）
・SAFE_SCORE_ERROR = 0.0（エラー）

3.3 spot_canの計算（Spotの動作確率）
--------------------------------------------------------------------------------
(1) 生スコア（spot_can_raw）の計算：
    各試行の総合スコアを平均して生スコアを算出

(2) シグモイド変換による確率化：
    CONFIDENCE_STEEPNESS = 15.0（急峻度）
    SELF_CAN_THRESHOLD = 0.50（中心点）
    
    x = CONFIDENCE_STEEPNESS * (spot_can_raw - SELF_CAN_THRESHOLD)
    
    if x > 20:
        spot_can = 1.0
    elif x < -20:
        spot_can = 0.0
    else:
        spot_can = 1.0 / (1.0 + exp(-x))
    
    この変換により、0.5付近の曖昧な値が0または1に明確に分離される。

3.4 ドローンとの通信
--------------------------------------------------------------------------------
Spotはドローンに以下の情報を送信する（customDataフィールド経由）：

(1) TRIGGER メッセージ（試行開始時）：
    フォーマット: "TRIGGER|leg_id|trial_index|direction|start_time|duration_ms"
    目的: ドローンに観測開始を通知

(2) JOINT_ANGLES メッセージ（試行中、毎フレーム）：
    フォーマット: "JOINT_ANGLES|leg_id|trial_index|angle0|angle1|angle2"
    目的: RoboPose観測のシミュレーション用に関節角度を送信

(3) SELF_DIAG メッセージ（試行終了時）：
    フォーマット: "SELF_DIAG|leg_id|trial_index|theta_samples|theta_avg|theta_final|tau_avg|tau_max|tau_limit|safety|self_can_raw"
    目的: 自己診断結果の詳細をドローンに送信

3.5 位置リセット機構
--------------------------------------------------------------------------------
各試行の後、使用した関節を0度位置にリセットする。
・リセット速度: モーター最大速度の15%（安定性重視）
・目的: 累積角度による物理的制約を防ぐ

================================================================================
4. ドローン観測システム（drone_observer）
================================================================================

4.1 RoboPoseによる観測
--------------------------------------------------------------------------------
USE_ONLY_ROBOPOSE = True（RoboPoseのみを使用）

ドローンは以下を観測：
・base_positions: Spotの胴体位置（時系列）
・base_orientations: Spotの胴体姿勢（roll、pitch、yaw）の時系列
・end_positions: 各脚の足先位置（時系列）
・joint_angles: 各脚の関節角度（時系列）

4.2 観測データからの特徴量抽出
--------------------------------------------------------------------------------
各試行について以下の特徴量を計算：

(1) delta_theta_deg（関節角度変化）：
    診断対象関節の最大角度 - 最小角度
    
(2) end_disp（足先変位）：
    試行開始時と終了時の足先位置間の直線距離（m）
    
(3) path_length（経路長）：
    足先が実際に移動した経路の総距離（m）
    
(4) path_straightness（経路直進性）：
    path_length / (end_disp + ε)
    値が大きいほど不規則な経路
    
(5) reversals（反転回数）：
    足先の移動方向が反転した回数
    
(6) base_height（胴体高さ）：
    試行中の平均胴体高さ（m）
    
(7) max_roll、max_pitch（最大傾斜）：
    試行中の最大roll角とpitch角（度）
    
(8) fallen（転倒フラグ）：
    roll または pitch が FALLEN_THRESHOLD_DEG（20度）を超えた場合 True

4.3 drone_canの計算（ドローンの動作確率）
--------------------------------------------------------------------------------
(1) 生スコア（drone_can_raw）の計算：
    各試行について：
    delta_theta_norm = clamp(delta_theta_deg / DELTA_THETA_REF_DEG)
    
    DELTA_THETA_REF_DEG = TRIAL_ANGLE_DEG = 4.0度
    
(2) 6試行の平均を計算：
    drone_can_raw = mean(各試行のdelta_theta_norm)

(3) シグモイド変換による確率化（spot_canと同じ方式）：
    CONFIDENCE_STEEPNESS = 15.0
    SELF_CAN_THRESHOLD = 0.50
    
    x = 15.0 * (drone_can_raw - 0.50)
    drone_can = 1.0 / (1.0 + exp(-x))

4.4 拘束原因の確率分布推定（p_drone）
--------------------------------------------------------------------------------
各試行の特徴量から、6種類の拘束原因の確率を推定する。

4.4.1 閾値の定義
・TRAPPED_ANGLE_THRESHOLD = 2.0度：関節が動く最小角度
・BURIED_ANGLE_THRESHOLD = 1.0度：完全に動かない閾値
・TRAPPED_DISPLACEMENT_THRESHOLD = 0.010m（10mm）：末端がほぼ動かない閾値
・BURIED_DISPLACEMENT_THRESHOLD = 0.005m（5mm）：完全に埋まっている閾値
・NORMAL_MIN_DISPLACEMENT = 0.015m（15mm）：正常な動きの最小変位
・NORMAL_MIN_ANGLE = 3.0度：正常な動きの最小角度

4.4.2 拘束原因の判定ロジック

【優先度1: FALLEN（転倒）】
条件: fallen == True（roll または pitch > 20度）
確率: FALLEN = min(0.95, max_angle / (FALLEN_THRESHOLD_DEG * 2))
      その他 = 0.01
説明: 転倒が検出された場合、最優先でFALLENと判定

【優先度2: TRAPPED（挟まる）】
条件: end_disp < 10mm AND delta_theta_deg > 2度
確率: TRAPPED = clamp(0.7 + (delta_theta_deg / 10.0))
      その他 = 低確率
説明: 関節は動くが足先がほぼ動かない状態

【優先度3: BURIED（埋まる）】
条件: end_disp < 5mm AND delta_theta_deg < 1度
確率: BURIED = 0.85
      その他 = 低確率
説明: 関節も足先もほとんど動かない状態

【優先度4: TANGLED（絡まる）】
条件: TRAPPED/BURIEDでない AND (path_straightness > 30.0 OR reversals > 10)
確率: straightness_score = min(0.5, (path_straightness - 30.0) / 100.0)
      reversal_score = min(0.5, (reversals - 10) * 0.05)
      TANGLED = clamp(straightness_score + reversal_score)
説明: 極端に不規則な経路パターン
備考: 正常な診断動作でも5-7回程度のreversalsは発生するため閾値を高く設定

【優先度5: NONE（正常）】
条件: delta_theta_deg >= 3度 AND end_disp >= 15mm AND 他の異常スコアが低い
確率: NONE = 0.9
      その他 = 低確率
説明: 関節も足先も十分に動いている

【優先度6: MALFUNCTION（故障）】
ドローンからは観測不可のため常に低確率（0.05）

4.4.3 確率分布の累積と平均化
各試行で計算した確率分布を累積し、6試行の平均を取る。
ただし、以下の特殊処理を行う：

(1) 転倒が検出されている場合：
    p_droneをFALLEN優先（fallen_confidence）に上書き
    
(2) NONEが支配的な場合（NONE > 60%）：
    p_drone = {NONE: 0.90, その他: 低確率}
    に上書きして正常判定を強化

4.5 転倒判定
--------------------------------------------------------------------------------
FALLEN_THRESHOLD_DEG = 20.0度

(1) セッション全体の転倒フラグ：
    いずれかの試行でroll または pitch > 20度の場合、_fallen = True
    
(2) 各脚ごとの転倒フラグ：
    その脚の試行中に転倒した場合、leg.fallen = True
    
(3) 転倒確率の計算：
    fallen_probability = min(1.0, max_angle / (FALLEN_THRESHOLD_DEG * 2))
    または
    fallen_probability = max_angle / FALLEN_THRESHOLD_DEG（転倒していない場合）

4.6 胴体傾斜補償（回転補償）
--------------------------------------------------------------------------------
転倒時や傾斜時に、胴体の回転を考慮して脚の動きを正確に診断する。
・initial_roll、initial_pitch: 試行開始時の胴体姿勢
・各フレームでroll/pitchの変化量を計算
・脚の位置座標を胴体相対座標系に変換

================================================================================
5. ルールベースLLMシステム（llm_client）
================================================================================

5.1 概要
--------------------------------------------------------------------------------
Spotの自己診断（spot_can）とドローン観測（drone_can、p_drone）を統合し、
最終的な診断結果を決定する。

5.2 ルール定義
--------------------------------------------------------------------------------
【ルール①】両方が0.7以上 → 動く、拘束原因=正常
条件: spot_can >= 0.7 AND drone_can >= 0.7
結果:
  ・movement_result = "動く"
  ・p_can = (spot_can + drone_can) / 2
  ・cause_final = "NONE"
  ・p_llm = {NONE: 0.94, その他: 低確率}

【ルール②】両方が0.3以下 → 動かない、拘束原因=確率分布の最大値
条件: spot_can <= 0.3 AND drone_can <= 0.3
結果:
  ・movement_result = "動かない"
  ・p_can = (spot_can + drone_can) / 2
  ・max_cause = max(p_drone.items(), key=lambda x: x[1])[0]
  ・cause_final = max_cause
  ・p_llm = {max_cause: 0.89, その他: 0.02}
注意: p_droneの全ての原因（NONEを含む）から最大値を選択する

【ルール③】片方が0.7以上、もう片方が0.3以下 → 動かない、拘束原因=故障
条件: (spot_can >= 0.7 AND drone_can <= 0.3) OR (spot_can <= 0.3 AND drone_can >= 0.7)
結果:
  ・movement_result = "動かない"
  ・p_can = (spot_can + drone_can) / 2
  ・cause_final = "MALFUNCTION"
  ・p_llm = {MALFUNCTION: 0.93, その他: 低確率}
説明: センサー間で矛盾する測定結果はセンサー故障を示唆

【ルール④】片方が中間値 → 一部動く、拘束原因=確率分布の最大値
条件: 上記ルール①②③に該当しない場合
結果:
  ・movement_result = "一部動く"
  ・p_can = (spot_can + drone_can) / 2
  ・max_cause = max(p_drone.items(), key=lambda x: x[1])[0]
  ・cause_final = max_cause
  ・p_llm = {max_cause: 0.69, NONE: 0.10, その他: 0.05}
注意: p_droneの全ての原因（NONEを含む）から最大値を選択する

5.3 閾値
--------------------------------------------------------------------------------
・CONFIDENCE_HIGH_THRESHOLD = 0.7（動くと判定する下限）
・CONFIDENCE_LOW_THRESHOLD = 0.3（動かないと判定する上限）

5.4 拘束原因の定義
--------------------------------------------------------------------------------
CAUSE_DEFINITIONS = {
    "NONE": "脚は正常に動作しており障害がない状態",
    "BURIED": "脚が地面や砂に埋まっており大きく持ち上げられない状態",
    "TRAPPED": "関節は動くのに末端が障害物等に固定され前進できない状態",
    "TANGLED": "ツタなどに絡まり小さい往復でしか動けない状態",
    "MALFUNCTION": "センサー故障または測定エラー（物理的に矛盾する状態）",
    "FALLEN": "ロボットが転倒しており正常な診断が困難な状態",
}

================================================================================
6. 診断パイプライン（pipeline）
================================================================================

6.1 診断の流れ
--------------------------------------------------------------------------------
(1) Spotが各脚に対して6回ずつ内部診断を行う（3.1参照）
(2) 各試行開始時にドローンにTRIGGERを送信
(3) 試行中、SpotはJOINT_ANGLESを毎フレーム送信
(4) ドローンはRoboPoseで姿勢を監査（4.1参照）
(5) 試行終了時、SpotはSELF_DIAGをドローンに送信
(6) ドローンは各試行の特徴量を計算（4.2参照）
(7) 全6試行終了後、Spotはspot_canを計算（3.3参照）
(8) ドローンはdrone_canとp_droneを計算（4.3、4.4参照）
(9) Spotはspot_canをドローンへ送信
(10) ドローンはspot_can、drone_can、p_droneをLLMに渡す
(11) LLMは最終的なp_canと拘束原因を決定（5.2参照）
(12) ドローンはSpotの姿勢を確認し転倒判定（4.5参照）
(13) 結果をログに記録し表示（6.2参照）

6.2 結果の表示と記録
--------------------------------------------------------------------------------
診断結果は以下の形式で表示される：

--------------------------------------------------------------------------------
  脚    |     動作状態     |   確信度    |    拘束原因    |    期待値    
--------------------------------------------------------------------------------
  FL   |     動く/動かない/一部動く     |  p_can   |  cause_final  |  expected  
  FR   |     ...
  RL   |     ...
  RR   |     ...
--------------------------------------------------------------------------------

転倒状態: 転倒している/転倒していない (確率: fallen_probability)

診断精度: X/4 (XX.X%)

6.3 ログファイル
--------------------------------------------------------------------------------
logs/ディレクトリに以下のJSONLファイルを出力：

(1) leg_diagnostics_events.jsonl：
    各試行の詳細データ（時系列データ、特徴量、スコア等）

(2) leg_diagnostics_sessions.jsonl：
    セッション全体のサマリー（最終診断結果、精度等）

================================================================================
7. データ構造（models）
================================================================================

7.1 LegState（脚の状態）
--------------------------------------------------------------------------------
各脚の診断結果を保持：
・leg_id: 脚のID（FL、FR、RL、RR）
・trials: TrialResultのリスト（6試行分）
・spot_can_raw: Spotの生スコア
・spot_can: Spotの動作確率（シグモイド変換後）
・drone_can_raw: ドローンの生スコア
・drone_can: ドローンの動作確率（シグモイド変換後）
・p_drone: ドローンが推定した拘束原因の確率分布
・p_llm: LLMが決定した最終確率分布
・cause_final: 最終的な拘束原因
・movement_result: 動作状態（"動く"、"動かない"、"一部動く"）
・p_can: 最終的な動作確率
・fallen: この脚の試行中に転倒したかどうか
・fallen_probability: 転倒確率

7.2 TrialResult（試行結果）
--------------------------------------------------------------------------------
各試行の詳細データ：
・trial_index: 試行番号（1-6）
・leg_id: 脚のID
・motor_index: 使用したモーターのインデックス（0-2）
・direction: 方向（"+", "-"）
・theta_cmd: 目標角度の時系列
・theta_meas: 実測角度の時系列
・omega_meas: 角速度の時系列
・tau_meas: トルクの時系列
・score_track: 追従性スコア
・score_vel: 速度スコア
・score_tau: トルクスコア
・score_safe: 安全性スコア
・score_total: 総合スコア
・spot_can_raw: この試行のSpot生スコア
・drone_can_raw: この試行のドローン生スコア
・ok: 試行が正常に完了したかどうか

7.3 LegStatus（脚の状態サマリー）
--------------------------------------------------------------------------------
view_result.py等で表示用：
・leg_id: 脚のID
・movement_result: 動作状態
・p_can: 動作確率
・cause_final: 拘束原因
・expected_cause: 期待される拘束原因（シナリオ設定から）
・fallen: 転倒フラグ
・fallen_probability: 転倒確率

================================================================================
8. 主要パラメータ一覧
================================================================================

8.1 診断パラメータ
--------------------------------------------------------------------------------
・TRIAL_COUNT = 6（試行回数）
・TRIAL_DURATION_S = 0.4秒（試行時間）
・TRIAL_ANGLE_DEG = 4.0度（目標角度の基準）
・実際の最大角度 = 5.0度（安全性考慮）
・モーター速度 = 最大速度の20%（試行時）、15%（リセット時）

8.2 スコア計算パラメータ
--------------------------------------------------------------------------------
・E_MAX_DEG = 3.0度（追従性の許容誤差）
・OMEGA_REF_DEG_PER_SEC = 27.0度/秒（基準角速度）
・TAU_LIMIT_RATIO = 0.8（トルク限界の80%）

8.3 シグモイド変換パラメータ
--------------------------------------------------------------------------------
・CONFIDENCE_STEEPNESS = 15.0（急峻度）
・SELF_CAN_THRESHOLD = 0.50（中心点）

8.4 LLM閾値
--------------------------------------------------------------------------------
・CONFIDENCE_HIGH_THRESHOLD = 0.7（動くと判定）
・CONFIDENCE_LOW_THRESHOLD = 0.3（動かないと判定）

8.5 ドローン観測閾値
--------------------------------------------------------------------------------
・TRAPPED_ANGLE_THRESHOLD = 2.0度
・BURIED_ANGLE_THRESHOLD = 1.0度
・TRAPPED_DISPLACEMENT_THRESHOLD = 0.010m（10mm）
・BURIED_DISPLACEMENT_THRESHOLD = 0.005m（5mm）
・NORMAL_MIN_DISPLACEMENT = 0.015m（15mm）
・NORMAL_MIN_ANGLE = 3.0度
・path_straightness閾値 = 30.0（TANGLED判定）
・reversals閾値 = 10回（TANGLED判定）

8.6 転倒判定パラメータ
--------------------------------------------------------------------------------
・FALLEN_THRESHOLD_DEG = 20.0度（roll/pitch）

================================================================================
9. 特殊処理と注意事項
================================================================================

9.1 安全機構
--------------------------------------------------------------------------------
・関節の可動範囲から±5度の安全マージンを確保
・各試行後に関節を0度位置にリセット
・速度を抑制（20%、15%）して転倒を防ぐ
・目標角度を最大5度に制限

9.2 シグモイド変換の役割
--------------------------------------------------------------------------------
0.5付近の曖昧な値を0または1に明確に分離し、診断の信頼性を向上させる。
CONFIDENCE_STEEPNESS = 15.0 により急峻な変換を実現。

9.3 NONE優先ロジック
--------------------------------------------------------------------------------
ドローン観測でNONEが60%以上の場合、正常と強く判定（0.90に引き上げ）。
これにより、正常な脚の誤診断を防ぐ。

9.4 転倒時の特殊処理
--------------------------------------------------------------------------------
転倒が検出された場合：
・p_droneをFALLEN優先に上書き（confidence 0.95）
・胴体の回転を補償して脚の動きを正確に評価
・各脚ごとに転倒フラグを記録

9.5 TANGLEDの判定基準
--------------------------------------------------------------------------------
正常な診断動作でも5-7回程度のreversalsは発生するため、
閾値を10回以上に設定して誤検出を防ぐ。
また、path_straightnessも30.0以上と高い閾値を設定。

9.6 ルール②④におけるNONEの扱い
--------------------------------------------------------------------------------
仕様では「確率分布の中の最も確率の高いもの」と記載されており、
NONEを除外しない。
したがって、p_droneでNONEが最大の場合、NONEが選択される。

================================================================================
10. システム構成
================================================================================

10.1 主要コントローラー
--------------------------------------------------------------------------------
・spot_self_diagnosis: Spotの自己診断制御
・drone_circular_controller: ドローンの円形軌道飛行と観測
・environment_manager: 環境設定の管理
・diagnostics_pipeline: 診断パイプライン統合

10.2 主要モジュール
--------------------------------------------------------------------------------
・config.py: 設定定数
・models.py: データ構造定義
・drone_observer.py: ドローン観測とp_drone推定
・llm_client.py: ルールベースLLM
・logger.py: ログ記録
・utils.py: ユーティリティ関数

10.3 結果表示スクリプト
--------------------------------------------------------------------------------
・view_result.py: 最新の診断結果を表示
・その他の分析スクリプト（analyze_*.py等）

================================================================================
11. 実装状況と既知の問題
================================================================================

11.1 完全実装済み機能
--------------------------------------------------------------------------------
✅ 6試行双方向診断パターン
✅ Spotの自己診断（spot_can計算）
✅ ドローン観測（drone_can、p_drone計算）
✅ ルールベースLLM統合
✅ シグモイド変換
✅ 転倒検出と補償
✅ 環境設定システム
✅ ログ記録
✅ 結果表示

11.2 現在の診断精度
--------------------------------------------------------------------------------
・TRAPPED（挟まる）シナリオ: 100%（4/4）
・BURIED（埋まる）シナリオ: 50%（2/4）- FL脚のみ正しく診断
  問題: FR/RL/RR脚が正常であるにもかかわらず挟まる等と誤診断

11.3 調査中の問題
--------------------------------------------------------------------------------
❌ FL脚がBURIED設定であるにもかかわらず正常（NONE）と診断される
   → 環境設定が正しく反映されていない可能性

❌ 正常な脚（FR/RL/RR）が挟まる（TRAPPED）や絡まる（TANGLED）と誤診断される
   → ドローン観測の閾値調整が必要な可能性

11.4 次のステップ
--------------------------------------------------------------------------------
(1) scenario.iniの設定を確認し、BURIED環境が正しく適用されているか検証
(2) 環境適用後の物理的状態を確認（砂パッチの位置、高さ等）
(3) 診断時のFL脚の実際の動き（変位、角度変化）をログで確認
(4) 必要に応じて閾値を再調整

================================================================================
以上
================================================================================
