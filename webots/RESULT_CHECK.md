# 診断結果の確認方法

## 🚀 クイックスタート

Webotsでシミュレーションを実行した後、以下のコマンドで結果を確認できます:

```bash
cd /home/kk21053/sotuken/webots
python3 check_result.py
```

## 📊 確認スクリプト

### 1. 基本結果の確認 - `check_result.py`

**使い方:**
```bash
python3 check_result.py
```

**表示内容:**
- 実行日時
- 各脚の診断結果（BURIED/NONE/TRAPPED/ENTANGLED）
- 期待値との比較
- 診断精度（正解率）

**出力例:**
```
📊 Spot脚診断システム - 結果表示
📁 ログファイル: diagnosis_20251012_012023.jsonl
🕒 実行日時: 20251012-01:20:23
================================================================================

FL脚:
  検出結果: BURIED     (信頼度: 0.279)
  期待値:   BURIED    
  判定:     ✓ 正解

📈 診断精度: 3/4 = 75.0%
```

---

### 2. 詳細データの確認 - `check_detail.py`

**使い方:**
```bash
python3 check_detail.py
```

**表示内容:**
- 使用しているモーター種類の推定
- 各試行の角度変化と足先変位
- 平均値と統計情報
- モーター動作の分析

**出力例:**
```
🔧 使用モーター: Shoulder (index 0 or 1)

【FL脚】 期待値: BURIED
--------------------------------------------------------------------------------
  Trial 1 ( +): 角度変化= +2.500°, 足先変位=0.029500m
  Trial 2 ( +): 角度変化= +2.500°, 足先変位=0.029500m
  Trial 3 ( -): 角度変化= -2.500°, 足先変位=0.029500m
  Trial 4 ( -): 角度変化= -2.500°, 足先変位=0.029500m

  平均角度変化: 2.500°
  平均足先変位: 0.029500m (閾値: 0.010000m)
  検出結果: NONE ✗
```

---

## 📁 ログファイルの場所

診断ログは以下の場所に保存されます:

```
controllers/spot_self_diagnosis/logs/
├── diagnosis_20251012_012023.jsonl          # 最終診断結果
├── leg_diagnostics_events.jsonl             # 全イベントログ
└── leg_diagnostics_sessions.jsonl           # セッション情報
```

### ログの直接確認

最新の診断結果を直接見る:
```bash
ls -lt controllers/spot_self_diagnosis/logs/diagnosis_*.jsonl | head -1
cat $(ls -t controllers/spot_self_diagnosis/logs/diagnosis_*.jsonl | head -1)
```

---

## 🔍 結果の読み方

### 期待される結果

現在のシナリオ設定では:
- **FL脚**: BURIED (砂に埋まっている) ← 検出すべき
- **FR脚**: NONE (正常)
- **RL脚**: NONE (正常)
- **RR脚**: NONE (正常)

### 判定基準

足先の平均変位で判定:
- 変位 < 0.01m (1cm) → **BURIED** と判定
- 変位 >= 0.01m → **NONE** と判定

### 診断精度の目標

- **100%**: すべての脚を正しく診断（理想）
- **75%**: 3/4脚を正しく診断（良好）
- **50%**: 2/4脚を正しく診断（改善が必要）
- **25%以下**: システムが機能していない

---

## 🔧 トラブルシューティング

### エラー: 診断ログが見つかりません

**原因:** Webotsシミュレーションが実行されていない

**対策:**
1. Webotsを起動
2. シミュレーションを実行（再生ボタン）
3. Spotが自動診断を完了するまで待つ
4. もう一度スクリプトを実行

### モーターがほとんど動いていません

**原因:** Elbow motor (index 2) など、物理的制約のあるモーターを使用

**対策:**
```bash
# spot_self_diagnosis.py を編集
# motor_index = 2  # ← これを変更
# motor_index = 0  # Shoulder Abduction
# または
# motor_index = 1  # Shoulder Rotation
```

### すべての脚がBURIEDと誤検出される

**原因:** モーターが動かない、または動きが小さすぎる

**対策:**
1. `check_detail.py` で平均角度変化を確認
2. 角度変化が < 1° の場合はモーターを変更
3. 角度変化が十分でも誤検出する場合は閾値を調整

---

## 📝 使用例

### 例1: 正常な診断
```bash
$ python3 check_result.py
📈 診断精度: 4/4 = 100.0%
```
→ すべて正解！システムが正常に動作しています。

### 例2: FL脚のみ正解
```bash
$ python3 check_result.py
📈 診断精度: 1/4 = 25.0%

$ python3 check_detail.py
⚠️  モーターの動きが小さいです (平均 < 1°)
```
→ モーターが動いていません。Elbow motorを使っている可能性があります。

### 例3: 詳細を確認して改善
```bash
$ python3 check_detail.py
🔧 使用モーター: Shoulder (index 0 or 1)
【FL脚】 平均角度変化: 2.500°
        平均足先変位: 0.029500m
        検出結果: NONE ✗
```
→ FL脚の足先変位が大きすぎます。砂のパラメータやモーター選択を見直してください。

---

## 🎯 まとめ

1. **シミュレーション実行後、まず `check_result.py` で全体を確認**
2. **精度が低い場合は `check_detail.py` で詳細を確認**
3. **モーターの動きや変位を見て、パラメータを調整**
4. **再度シミュレーションを実行して確認**

このサイクルを繰り返して、診断精度を向上させます。
